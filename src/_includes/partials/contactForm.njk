<form 
            id="{{ contactForm.formId }}"
            ref="{{ contactForm.formRef }}"
            method="{{ contactForm.method }}"
            action="{{ contactForm.action }}"
>
<div class="field">
  <input 
    type="hidden"  
    name="access_key"
    value="{{ env.W3F_API_KEY }}"
  />
  <input 
    type="hidden"  
    name="subject"
    value="MCEA website - new message submission"
  />
  <input 
    type="hidden"  
    name="redirect"
    value="https://www.mcea.org.uk/contact"
  />
</div>
{% for field in contactForm.fields %}
  <div class="field">
    <label class="label">{{ field.label }}</label>
    <div class="control">
      {% if field.controlType == "input" %}
        <input
          class="input"
          type="{{ field.inputType }}"
          name="{{ field.name }}"
          placeholder="{{ field.placeholder }}"
          {% if field.required %} required="required"{% endif %}
          {% if field.pattern %} pattern="{{ field.pattern }}"{% endif %}
        />
      {% elif field.controlType == "textarea" %}
        <textarea
          class="textarea"
          name="{{ field.name }}"
          placeholder="{{ field.placeholder }}"
          {% if field.required %} required="required"{% endif %}
          {% if field.minlength %} minlength="{{ field.minlength }}"{% endif %}
        ></textarea>
      {% endif %}
    </div>
  </div>
{% endfor %}
  <div class="h-captcha" data-captcha="true"></div>
  <button class="{{ contactForm.submitButton.class }}" type="submit">{{ contactForm.submitButton.text }}</button>
  <div id="successContainer" style="display: none;">
    <div class="field">
      <label class="label">Success</label>
      <div class="control">
        <span id="successMessage">Your message has been sent successfully!</span>
      </div>
    </div>
  </div>
</form>
<!-- Modal for success message -->
<div id="successModal" class="modal">
  <div class="modal-background"></div>
  <div class="modal-content">
    <div class="box">
      <h3 class="has-text-weight-semibold">Success!</h3>
      <p id="successText"></p>
      <button id="closeModal" class="button is-primary">Close</button>
    </div>
  </div>
</div>
<script src="https://web3forms.com/client/script.js" async defer></script>
<script>
// Smooth scroll function
function scrollToTop() {
  window.scrollTo({
    top: 0,
    behavior: 'smooth'
  });
}

// Show success message
function showSuccessMessage(message) {
  document.getElementById('successContainer').style.display = 'block';
  document.getElementById('successMessage').textContent = message;
  document.getElementById('successModal').classList.remove('is-hidden');
  scrollToTop();
}

// Close modal
document.getElementById('closeModal').addEventListener('click', function() {
  document.getElementById('successModal').classList.add('is-hidden');
});

// Wait for DOMContentLoaded before setting up event listeners
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('contactForm');

  // Form submission handler
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Send form data to server
    fetch(form.action, {
      method: 'POST',
      body: new FormData(form),
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        showSuccessMessage(data.message || 'Your message has been sent successfully!');
        setTimeout(() => {
          document.getElementById('successContainer').style.display = 'none';
          document.getElementById('successModal').classList.add('is-hidden');
        }, 5000); // Hide after 5 seconds
      } else {
        console.error('Error:', data.message);
        // Handle error case (e.g., show error message)
      }
    });
  });

  // Add event listener to Web3Forms form submission
  form.addEventListener('w3f-form-submitted', function(event) {
    showSuccessMessage("Your message has been sent successfully!");
    setTimeout(() => {
      document.getElementById('successContainer').style.display = 'none';
      document.getElementById('successModal').classList.add('is-hidden');
    }, 5000); // Hide after 5 seconds
  });
});

// Initialize the form with Web3Forms
Web3Forms.init({
  formId: "{{ contactForm.formId }}",
  formRef: "{{ contactForm.formRef }}",
  submitPrevent: "{{ contactForm.submitPrevent }}",
  method: "{{ contactForm.method }}",
  action: "{{ contactForm.action }}",
  fields: {{ contactForm.fields | json }},
  hiddenFields: {{ contactForm.hiddenFields | json }},
  recaptcha: {{ contactForm.recaptcha | json }},
  submitButton: {{ contactForm.submitButton | json }}
});
</script>